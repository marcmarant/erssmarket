{% extends "base/base.html" %}

{% block title %}Selector de productos{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/carrito.css') }}">
{% endblock %}

{% block content %}
     <div class="carrito">
        {% if not carrito %}
            <h2>El carrito está vacío</h2>
        {% else %}
            {% for producto in carrito %}
                <div class="producto">
                    <div class="producto-left">
                        <h3>{{ producto.nombre }}</h3>
                        <h3>{{ producto.precio }}€ x{{ producto.cantidad }} Unidades</h3>
                    </div>
                    <div class="producto-right">
                        <i class="fa-solid fa-minus" id="quitarItem" data-producto-id="{{ producto.id }}"></i>
                        <img src="{{ producto.fotoUrl }}" alt="{{ producto.nombre }}">
                    </div>
                </div>
            {% endfor %}
            <h2>Precio Total: {{ precio_total }}€</h2>
        {% endif %}
    </div>
    {% if carrito %}
        <div class="buttons">
            <button id="vaciarCarrito">Vaciar Carrito</button>
            <button id="pagarCarrito">Pagar Carrito</button>
        </div>
    {% endif %}
{% endblock %}

{% block script %}
    <script>
        document.getElementById('vaciarCarrito').addEventListener('click', function () {
            fetch('api/carrito/vaciar', {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
            }).then(result => {
                alert(result.message);
                window.location.reload()
            }).catch(error => {
                console.error('Error al añadir al vaciar el carrito:', error);
            });
        });

        document.getElementById('pagarCarrito').addEventListener('click', function () {
            fetch('api/checkout', {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
            }).then(result => {
                alert(result.message);
                window.location.reload()
            }).catch(error => {
                console.error('Error al añadir al vaciar el carrito:', error);
            });
        });

        document.querySelectorAll('.quitarItem').forEach(button => {
            button.addEventListener('click', function () {
                const productoId = this.dataset.productoId;
                fetch(`api/carrito/${productoId}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                })
                .then(result => {
                    window.location.reload();
                }).catch(error => {
                    console.error('Error al quitar el producto del carrito:', error);
                });
            });
        });        
    </script>

{% endblock %}
